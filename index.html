<!doctype>
<html>
  <head>
    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    <style type="text/css">
    body {
      font-family: AppleColorEmoji;
      font-size: 15px;
    }
    .bomb {
      color: red;
    }
    .lot {
      width: 25px;
      height: 25px;
      display: inline-block;
      background: #eee;
      position: relative;
      padding: 2px 3px;
      vertical-align: middle;
    }

    .lot.masked {
      font-size: 0;
    }
    .lot.masked:before {
      content: "‚óªÔ∏è";
      font-size: 15px;
    }
    </style>
  </head>
  <body>
    <script>
      var x = 10
      var y = 10
      var bomb_n = 10
      var bombed = 0
      var rate = bomb_n/(x*y)
      var cell_n = x*y
      var evaluated = 0
      var bomb_map = []
      var numbers = ["  ", "1Ô∏è‚É£", "2Ô∏è‚É£", "3Ô∏è‚É£", "4Ô∏è‚É£", "5Ô∏è‚É£", "6Ô∏è‚É£", "7Ô∏è‚É£", "8Ô∏è‚É£"]

      shuffle(bomb_arr(rate)).forEach(function(a, i) {
        var x_cord = Math.floor((i+1)%x) || 10
        var y_cord = Math.ceil((i+1)/y)
        $("body").append(mine(a).addClass("x"+ x_cord + " y" + y_cord))
        if (x_cord === x) $("body").append("<br>")
      })

      $.fn.neightbors = function() {
        var arr = []
        var x_p = this.context.className.match(/x(\d+)/)[1]
        var y_p = this.context.className.match(/y(\d+)/)[1]
        arr.push($(".x" + x_p + ".y" + (Number(y_p) + 1)))
        arr.push($(".x" + x_p + ".y" + (Number(y_p) - 1)))
        arr.push($(".x" + (Number(x_p) + 1) + ".y" + y_p))
        arr.push($(".x" + (Number(x_p) - 1) + ".y" + y_p))
        arr.push($(".x" + (Number(x_p) + 1) + ".y" + (Number(y_p) - 1)))
        arr.push($(".x" + (Number(x_p) + 1) + ".y" + (Number(y_p) + 1)))
        arr.push($(".x" + (Number(x_p) - 1) + ".y" + (Number(y_p) - 1)))
        arr.push($(".x" + (Number(x_p) - 1) + ".y" + (Number(y_p) + 1)))
        return arr
      }

      var lots = $(".lot")
      lots.each(function(i, o) {
        if(!$(o).hasClass("bomb")) {
          var count = 0
          $(o).neightbors().forEach(function(n) {
            if(n.hasClass("bomb")) count ++
          })
          if (count === 0) $(o).addClass("space")
          o.innerText = numbers[count]
        }
      })

      $(document).on("click", ".lot", function() {
        console.log(this, "clicked")
        console.log($(this).neightbors())
        $(this).removeClass("masked")
        if(this.classList.contains("bomb")) {
          $(".lot").removeClass("masked")
        } else if ($(this).hasClass("space")) {
          $(this).neightbors().forEach(function(n) {
            if($(n).is(".masked:not(.bomb)")) {
              $(n).removeClass("masked").click()
            }
          })
        }
      })

      function mine (number) {
        var base = $("<span class='lot masked'>")
        if (number > 0) {
          base.addClass("bomb").text("üí•")
        }
        return base
      }

      function bomb_arr (chance) {
        var chance = chance * cell_n
        var arr = []
        for(var i=0; i < chance; i++) {
          arr.push(true)
        }
        for(var n=0; n < (cell_n - chance); n++) {
          arr.push(false)
        }
        return arr
      }
      function shuffle(array) {
        var currentIndex = array.length, temporaryValue, randomIndex ;
        while (0 !== currentIndex) {
          randomIndex = Math.floor(Math.random() * currentIndex);
          currentIndex -= 1;
          temporaryValue = array[currentIndex];
          array[currentIndex] = array[randomIndex];
          array[randomIndex] = temporaryValue;
        }
        return array;
      }
    </script>
  </body>
</html>